<!DOCTYPE html>
<meta charset="utf-8">
    <style>
        
        .dot circle {
            fill: black;
            stroke: black;
            stroke-width: 1px;
        }
        
        .dot circle.dragging {
            fill: red;
            stroke: brown;
        }
        
        .axis line {
            fill: none;
            stroke: #000;
            stroke-width: 1;
            opacity: 1;
            shape-rendering: crispEdges;
            vector-effect: non-scaling-stroke;
        }
        
        #tooltip {
            position: absolute;
            width: 200px;
            height: auto;
            padding: 10px;
            background-color: white;
            -webkit-border-radius: 10px;
            -moz-border-radius: 10px;
            border-radius: 10px;
            -webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
            pointer-events: none;
        }
        
        #tooltip.hidden {
            display: none;
        }
        
        #tooltip p {
            margin: 0;
            font-family: sans-serif;
            font-size: 16px;
            line-height: 20px;
        }
        
        </style>
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
    <body>
        <p> Press on any part of the chart to add. Hold the shift-key and  
            press on a dot to delete. Dots are draggable.</p>
            
            
            
            
            
            
            
   <!-- D3 script -->        
        <script src="assets/d3.v3.min.js"></script>
        <script>
            var mode = 0;
            var isDrag = 1;
            
            var margin = {top: -5, right: -5, bottom: -5, left: -5},
            width = 1160 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;
            
            var zoom = d3.behavior.zoom()
            .scaleExtent([1, 5])
            .on("zoom", zoomed);
            
            var drag = d3.behavior.drag()
            //.origin(function(d) { return d; })
            .on("dragstart", dragstarted)
            .on("drag", dragged)
            .on("dragend", dragended);
            
            var svg = d3.select("body").append("svg")
			.attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.right + ")")
            .on("click", added)   // adds a new dot?
            .call(zoom);

            var defs = svg.append("defs");
            
            defs.append('svg:linearGradient')
            .attr('x1', "0%").attr('y1', "100%").attr('x2', "0%").attr('y2', "0%")
            .attr('id', 'tempgradient').call(
                                         function (gradient) {
                                         gradient.append('svg:stop').attr('offset', '0%').attr('style', 'stop-color:rgb(0,23,153);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '5%').attr('style', 'stop-color:rgb(1,27,236);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '15%').attr('style', 'stop-color:rgb(0,56,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '25%').attr('style', 'stop-color:rgb(0,84,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '35%').attr('style', 'stop-color:rgb(0,160,254);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '45%').attr('style', 'stop-color:rgb(0,208,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '55%').attr('style', 'stop-color:rgb(158,255,100);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '65%').attr('style', 'stop-color:rgb(255,229,49);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '75%').attr('style', 'stop-color:rgb(255,102,0);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '85%').attr('style', 'stop-color:rgb(214,19,0);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '100%').attr('style', 'stop-color:rgb(30,30,30);stop-opacity:.7');
                                         });
            
            //actually drawing rainbow box:
            var rect = svg.append("rect")
            .attr("width", width - 300)
            .attr("height", height)
            .style("fill", "url(#tempgradient)")
            .style("pointer-events", "all");
            
            var container = svg.append("g");
            
            
			// add axes ---> svg.append( but then what kind of thing should it be?  Line?  rect? ...look it up.
            var x = d3.time.scale()  //set time scale -- NEED TO FIX
					.domain([10000,100000])
					.range([0, width]),
                y = d3.scale.linear()  //set temp scale
					.domain([40,90])
					.range([height, 0]); 
            
            var xAxis = d3.svg.axis().scale(x).orient("bottom"), 
                yAxis = d3.svg.axis().scale(y).orient("left");
            
            //make tickmark grid
            container.append("g")
            .attr("class", "x axis")
            .selectAll("line")
            .data(d3.range(0, width - 300, 50))
            .enter().append("line")
            .attr("x1", function(d) { return d; })
            .attr("y1", 0)
            .attr("x2", function(d) { return d; })
            .attr("y2", height);
            
            container.append("g")
            .attr("class", "y axis")
            .selectAll("line")
            .data(d3.range(0, height, 50))
            .enter().append("line")
            .attr("x1", 0)
            .attr("y1", function(d) { return d; })
            .attr("x2", width - 300)
            .attr("y2", function(d) { return d; });
			//done making tickmark grid
			
            
            var initGraph = function() {
                d3.tsv("test.tsv", dottype, function(error, dots) {
                       dot = container.append("g")
                       .attr("class", "dots")
                       .selectAll("circle")
                       .data(dots)
                       .enter().append("g")
                       .attr("class", "dot")
                       .append("circle")
                       .attr("r", 20)
                       .attr("cx", function(d) { return d.x; })
                       .attr("cy", function(d) { return d.y; })
                       .on("click", context)
                       .call(drag);
                       });
            } 
            
            
            function dottype(d) {
                d.x = +d.x;
                d.y = +d.y;
                return d;
            }
            
            function zoomed() {
                if (mode == 5) {
                    rect.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                    container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                }
            }
           
            
			
			
			
			
			
			
			// Add a dot where the user clicks, and record them in "TimeTempData" array:
			var TimeTempData = [];
			
            function added() {
                if (isDrag == 0) {
                    var coords = d3.mouse(this);
                    var DotGroup = container.select(".dots").append("g");
					DotGroup.attr("class", "dot")                    
                    	.append("circle")
						.attr("r", 15)
						.attr("cx", function(d) { return coords[0]; })
						.attr("cy", function(d) { return coords[1]; })
						
						
					//add text label to each dot:
					DotGroup.append("text")
						.attr("dx", 14)
						.attr("dy", ".35em")
						.attr("x", function(d) { return coords[0] - 23; })
						.attr("y", function(d) { return coords[1]; })
						.attr("font-weight","Bold")
						.attr('fill', '#FFF')
						// .text("73")
						.text(function(d) { return Math.round(y.invert(coords[1]) ) })
						.style('font-family', 'Arial');
						
					DotGroup.circle
						.on("click", context)                
                    	.call(drag);
					//done adding a dot & labeling it							
					
					
					//to pull temp & time from x,y pixel values:
					
					var TransformedCoords = 
					    [x.invert(coords[0]), y.invert(coords[1])];
						 //   [x.invert(coords[0]), y.invert(coords[1])];
					TimeTempData.push(TransformedCoords);
				
			
					
                } else {
                    isDrag = 0;
                }
            }
            
            function context() {
                if (d3.event.shiftKey) {
                    d3.select(this).remove();
                }
            }
            
            function dragstarted(d) {
                isDrag = 1;
                d3.event.sourceEvent.stopPropagation();
                d3.select(this).classed("dragging", true);
            }
            
            function dragged(d) {
                console.log(d3.event.x);
                console.log(d3.event.y);
                d3.select(this)
					.attr("cx", function() { return d3.event.x; })
                	.attr("cy", function() { return d3.event.y; })
					.attr("x", function() { return d3.event.x - 23; })  //move text, too
					.attr("y", function() { return d3.event.y; });      //move text, too

            }
            
            function dragended(d) {
                d3.select(this).classed("dragging", false);
            }
            
            initGraph();
            
			
			
			
			
			
			
			
			
			
			
//Draw temperature readings in upper right
var TempYOffset = 270;

svg.append("text")  //just text labels
	.attr("x", width - TempYOffset)
	.attr("y", 24)
	.style("fill", "#000")
	.attr("font-weight","Bold")
	.style('font-family', 'Arial')
	.style('font-size', '20px')
	.text("Temperatures Now:");
svg.append("text") 
	.attr("x", width - TempYOffset)
	.attr("y", 60)
	.style("fill", "#000")
	.attr("font-weight","Bold")
	.style('font-family', 'Arial')
	.style('font-size', '16px')
	.text("Operative:");
svg.append("text") 
	.attr("x", width - TempYOffset)
	.attr("y", 110)
	.style("fill", "#000")
	//.attr("font-weight","Bold")
	.style('font-family', 'Arial')
	.style('font-size', '12px')
	.text("Air & Radiant:");
	

var OperTempRect = svg.append("rect")  // Operative temp. box
    .attr("width", 100)
	.attr("height", 50)
	.attr("x", width - TempYOffset + 80)
	.attr("y", 28)
	.style("fill", "#ffff00")
	.style("stroke", "#000000")
	.style("stroke-width", "1px")
	.style("pointer-events", "all");  // what does this do?
	
	svg.append("text") 
		.attr("x", width - TempYOffset + 115)
		.attr("y", 60)
		.style("fill", "#000")
		.attr("font-weight","Bold")
		.style('font-family', 'Arial')
		.style('font-size', '22px')
		.text("75°"); 
		//function(d) { return Math.round(y.invert(coords[1]) ) } );
	
	svg.append("rect")  // Air temp. box
		.attr("width", 50)
		.attr("height", 50)
		.attr("x", width - TempYOffset + 80)
		.attr("y", 78)
		.style("fill", "#bbff00")
		.style("stroke", "#000000")
		.style("stroke-width", "1px")
		.style("pointer-events", "all");  // what does this do?
		
		svg.append("text")  // Air temp text
			.attr("x", width - TempYOffset + 92)
			.attr("y", 110)
			.style("fill", "#000")
			.attr("font-weight","Bold")
			.style('font-family', 'Arial')
			.style('font-size', '16px')
			.text("73°"); 

		
	svg.append("rect")  // Radiant temp. box
		.attr("width", 50)
		.attr("height", 50)
		.attr("x", width - TempYOffset + 80 + 50)
		.attr("y", 78)
		.style("fill", "#ffbb00")
		.style("stroke", "#000000")
		.style("stroke-width", "1px")	
	
		svg.append("text")   // Radiant temp text
			.attr("x", width - TempYOffset + 145)
			.attr("y", 110)
			.style("fill", "#000")
			.attr("font-weight","Bold")
			.style('font-family', 'Arial')
			.style('font-size', '16px')
			.text("77°"); 
	
		
//Done drawing temperature readings in upper right
		
			
			
			
			
			
			
			
			
			
			
			
			
			
            </script>


