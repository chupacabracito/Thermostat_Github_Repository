<!DOCTYPE html>
<meta charset="utf-8">
    <style>
        body {
            font: 10px sans-serif;
        }
        
        .dot circle {
            fill: lightsteelblue;
            stroke: steelblue;
            stroke-width: 1.5px;
        }
        
        .dot circle.dragging {
            fill: red;
            stroke: brown;
        }
        
        .axis path, .axis line {
            fill: none;
            stroke: #000;
            stroke-width: 0.5;
            opacity: .1;
            shape-rendering: crispEdges;
            vector-effect: non-scaling-stroke;
        }
        
        .x.label, .y.label {
            font-size: 10px;
            fill: #fff;
        }
        
        div.tooltip {
            position: absolute;
            text-align: center;
            width: 60px;
            height: 12px;
            padding: 8px;
            font: 10px sans-serif;
            background: #ddd;
            border: solid 1px #aaa;
            border-radius: 8px;
            pointer-events: none;
        }
        
        </style>
    <body>
        <p> Press on any part of the chart to add. Hold the shift-key and press on a dot to delete. Dots are draggable.</p>
        <!-- D3 script -->        
        <script src="assets/d3.v3.min.js"></script>
        <script>
            var mode = 0;
            var isDrag = 1;
            
            var margin = {top: 20, right: 20, bottom: 20, left: 30},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;
            
            var parse = d3.time.format("%Y-%m-%d %H:%M:%S").parse,
                format = d3.time.format("%Y-%m-%d %H:%M");
            
            var zoom = d3.behavior.zoom()
            .scaleExtent([1, 5])
            .on("zoom", zoomed);
            
            var drag = d3.behavior.drag()
            //.origin(function(d) { return d; })
            .on("dragstart", dragstarted)
            .on("drag", dragged)
            .on("dragend", dragended);
            
            var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.right + ")")
            .on("click", added)
            .call(zoom);

            var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 1e-6);
            
            var defs = svg.append("defs");
            
            defs.append('svg:linearGradient')
            .attr('x1', "0%").attr('y1', "100%").attr('x2', "0%").attr('y2', "0%")
            .attr('id', 'gradient').call(
                                         function (gradient) {
                                         gradient.append('svg:stop').attr('offset', '0%').attr('style', 'stop-color:rgb(0,23,153);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '10%').attr('style', 'stop-color:rgb(1,27,236);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '20%').attr('style', 'stop-color:rgb(0,56,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '30%').attr('style', 'stop-color:rgb(0,84,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '40%').attr('style', 'stop-color:rgb(0,160,254);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '45%').attr('style', 'stop-color:rgb(0,208,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '50%').attr('style', 'stop-color:rgb(158,255,100);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '60%').attr('style', 'stop-color:rgb(255,229,49);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '75%').attr('style', 'stop-color:rgb(255,102,0);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '85%').attr('style', 'stop-color:rgb(214,19,0);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '100%').attr('style', 'stop-color:rgb(30,30,30);stop-opacity:.7');
                                         });
            
            
            var rect = svg.append("rect")
            .attr("width", width)
            .attr("height", height)
            .style("fill", "url(#gradient)")
            .style("pointer-events", "all");
            
            var container = svg.append("g");
            
            var d1 = new Date(2013, 10, 27, 5, 30, 0, 0);
            var d2 = new Date(2013, 10, 27, 5, 35, 0, 0);
            var x = d3.time.scale().domain([d1,d2]).range([0, width]),
                y = d3.scale.linear().domain([-60, 110]).range([height, 0]);
            
            var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(20),
                yAxis = d3.svg.axis().scale(y).orient("left").ticks(20);
            
            container.append("g")
            .attr("class", "x axis")
            .selectAll("line")
            .data(d3.range(0, width, 10))
            .enter().append("line")
            .attr("x1", function(d) { return d; })
            .attr("y1", 0)
            .attr("x2", function(d) { return d; })
            .attr("y2", height);
            
            container.append("g")
            .attr("class", "y axis")
            .selectAll("line")
            .data(d3.range(0, height, 10))
            .enter().append("line")
            .attr("x1", 0)
            .attr("y1", function(d) { return d; })
            .attr("x2", width)
            .attr("y2", function(d) { return d; });
            
            var initGraph = function() {
                d3.tsv("test.tsv", dottype, function(error, dots) {
                       dot = container.append("g")
                       .attr("class", "dots")
                       .selectAll("circle")
                       .data(dots)
                       .enter().append("g")
                       .attr("class", "dot")
                       .append("circle")
                       .attr("r", 5)
                       .attr("cx", function(d) {
                             console.log(parse(d.date + " " + d.time));
                             return x(parse(d.date + " " + d.time)); })
                       .attr("cy", function(d) {
                             //console.log(d.temp);
                             return y(d.temp); })
                       .on("click", context)
                       .on("mouseover", mouseover)
                       .on("mousemove", mousemove)
                       .on("mouseout", mouseout)
                       .call(drag);
                       });
            } 
            
            
            function dottype(d) {
                d.x = +d.x;
                d.y = +d.y;
                return d;
            }
            
            function zoomed() {
                if (mode == 5) {
                    rect.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                    container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                }
            }
           
            
            function added() {
                if (isDrag == 0) {
                    var coords = d3.mouse(this);
                    container.select(".dots")
                    .append("g")
                    .attr("class", "dot")                    
                    .append("circle")
                    .attr("r", 5)
                    .attr("cx", function(d) { return coords[0]; })
                    .attr("cy", function(d) { return coords[1]; })
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseout", mouseout)
                    .on("click", context)                    
                    .call(drag)
                } else {
                    isDrag = 0;
                }
            }
            
            function context() {
                if (d3.event.shiftKey) {
                    d3.select(this).remove();
                }
            }
            
            function dragstarted(d) {
                isDrag = 1;
                d3.event.sourceEvent.stopPropagation();
                d3.select(this).classed("dragging", true);
            }
            
            function dragged(d) {
                //console.log(d3.event.x);
                //console.log(d3.event.y);
                d3.select(this).attr("cx", function() { return d3.event.x; })
                .attr("cy", function() { return d3.event.y; });
            }
            
            function dragended(d) {
                d3.select(this).classed("dragging", false);
            }
            
            function mouseover() {
                div.transition()
                .duration(100)
                .style("opacity", .7);
            }
            
            function mousemove() {
                var x0 = x.invert(d3.mouse(this)[0]);
                var y0 = y.invert(d3.mouse(this)[1]);
                div
                .text(x0 + ", " + y0)//d3.event.pageY)
                .style("left", (d3.event.pageX + 20) + "px")
                .style("top", (d3.event.pageY - 12) + "px");
            }
            
            function mouseout() {
                div.transition()
                .duration(500)
                .style("opacity", 1e-6);
            }
            
            // Create X Axis label
            container.append("text")
            .attr("class", "x label")
            .attr("text-anchor", "end")
            .attr("x", width + margin.right - 35)
            .attr("y", height + margin.bottom - 25)
            .text("Time (Months/Years)");
            
            // Create Y Axis label
            container.append("text")
            .attr("class", "y label")
            .attr("text-anchor", "end")
            .attr("y", -margin.left+40)
            .attr("x", -12)
            .attr("dy", ".75em")
            .attr("transform", "rotate(-90)")
            .text("Temperature (ÂºF)");

            
            svg.append("g").attr("class", "x axis")
            .attr("transform", "translate(" + 0 + "," + height + ")")
            .call(xAxis);
            svg.append("g").attr("class", "y axis")
            .call(yAxis);
            
            
            
            initGraph();
            
            </script>


