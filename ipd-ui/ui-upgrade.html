<!DOCTYPE html>
<meta charset="utf-8">

<<<<<<< HEAD
   //useless comment--adding it to see if branching and merging works
   //second useless comment


=======
>>>>>>> integrating-D3
    <style>
        body {
            font: 20px sans-serif;
        }
        
        .dot circle {
            fill: black;
            stroke: black;
            stroke-width: 1px;
        }
        
        .dot circle.dragging {
            fill: red;
            stroke: brown;
        }
        
        .axis path, .axis line {
            fill: none;
            stroke: #000;
            stroke-width: 1;
            opacity: 1;
            shape-rendering: crispEdges;
            vector-effect: non-scaling-stroke;
        }
        
        .x.label, .y.label {
            font-size: 20px;
            fill: #000;
        }
        
        div.tooltip {
            position: absolute;
            text-align: center;
            width: 60px;
            height: 12px;
            padding: 8px;
            font: 10px sans-serif;
            background: #ddd;
            border: solid 1px #aaa;
            border-radius: 8px;
            pointer-events: none;
        }
        
        </style>
        
       
        
        
        
    <body>
        <p> Press on any part of the chart to add. Hold the shift-key and press on a dot to delete. Dots are draggable.</p>
        <!-- D3 script -->        
        <script src="assets/d3.v3.min.js"></script>
        <script>
		var SVGWidth = 1160;  // width of whole SVG object
        var SVGHeight = 500;  // height of whole SVG object
		var SidebarWidth = 270;  // width of sidebar displaying current temp & heating / cooling
		
            var mode = 0;
            var isDrag = 1;
            
            var margin = {top: 20, right: 40, bottom: 80, left: 60},
            width = SVGWidth - SidebarWidth - margin.left - margin.right,
            height = SVGHeight - margin.top - margin.bottom;
            
            var parse = d3.time.format("%Y-%m-%d %H:%M:%S").parse,
                format = d3.time.format("%Y-%m-%d %H:%M");
            
            var zoom = d3.behavior.zoom()
            .scaleExtent([1, 5])
            .on("zoom", zoomed);
            
            var drag = d3.behavior.drag()
            //.origin(function(d) { return d; })
            .on("dragstart", dragstarted)
            .on("drag", dragged)
            .on("dragend", dragended);
            
            var svg = d3.select("body").append("svg")
            .attr("width", SVGWidth)
            .attr("height", SVGHeight)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.right + ")")
            .on("click", added)      // adds a new dot?
            .call(zoom);


			// Maybe this's popup time & temp display?
            var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 1e-6);
			
			
            
            var defs = svg.append("defs");
            
            defs.append('svg:linearGradient')
            .attr('x1', "0%").attr('y1', "100%").attr('x2', "0%").attr('y2', "0%")
            .attr('id', 'gradient').call(
                                         function (gradient) {
                                         gradient.append('svg:stop').attr('offset', '0%').attr('style', 'stop-color:rgb(0,23,153);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '10%').attr('style', 'stop-color:rgb(1,27,236);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '20%').attr('style', 'stop-color:rgb(0,56,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '30%').attr('style', 'stop-color:rgb(0,84,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '40%').attr('style', 'stop-color:rgb(0,160,254);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '45%').attr('style', 'stop-color:rgb(0,208,255);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '50%').attr('style', 'stop-color:rgb(158,255,100);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '60%').attr('style', 'stop-color:rgb(255,229,49);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '75%').attr('style', 'stop-color:rgb(255,102,0);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '85%').attr('style', 'stop-color:rgb(214,19,0);stop-opacity:.7');
                                         gradient.append('svg:stop').attr('offset', '100%').attr('style', 'stop-color:rgb(30,30,30);stop-opacity:.7');
                                         });
            
            //actually drawing rainbow box:
            var rect = svg.append("rect")
            .attr("width", width)
            .attr("height", height)
            .style("fill", "url(#gradient)")
            .style("pointer-events", "all");
            
            var container = svg.append("g");
            
			// Set scales for time & temp axes:
            var d1 = new Date(2013, 10, 27, 5, 30, 0, 0);
            var d2 = new Date(2013, 10, 27, 5, 31, 0, 0);   // This's only a one-minute time span!
            var x = d3.time.scale().domain([d1,d2]).range([0, width]),
                y = d3.scale.linear().domain([40, 90]).range([height, 0]);
            
			
			// Set number of ticks on axes:
            var xAxis = d3.svg.axis().scale(x).orient("bottom").ticks(10),  // was ticks(d3.time.hour, 3),
                yAxis = d3.svg.axis().scale(y).orient("left").ticks(10);
            
			
			
			//make grid lines
            container.append("g")
            .attr("class", "x axis")
            .selectAll("line")
            .data(d3.range(0, width, 65.9 ))  // 65.9 makes a grid line every 5 sec for 1 min timespan.
            .enter().append("line")
            .attr("x1", function(d) { return d; })
            .attr("y1", 0)
            .attr("x2", function(d) { return d; })
            .attr("y2", height);
            
            container.append("g")
            .attr("class", "y axis")
            .selectAll("line")
            .data(d3.range(0, height, 40 ))  // 40 makes a grid line every 5Â°F.
            .enter().append("line")
            .attr("x1", 0)
            .attr("y1", function(d) { return d; })
            .attr("x2", width)
            .attr("y2", function(d) { return d; });
            //done making grid lines
			
			
			
			// Start the graph with some stock datapoints?
            var initGraph = function() {
                d3.tsv("test.tsv", dottype, function(error, dots) {
                       dot = container.append("g")
                       .attr("class", "dots")
                       .selectAll("circle")
                       .data(dots)
                       .enter().append("g")
                       .attr("class", "dot")
                       .append("circle")
                       .attr("r", 5)
                       .attr("cx", function(d) {
                             console.log(parse(d.date + " " + d.time));
                             return x(parse(d.date + " " + d.time)); })
                       .attr("cy", function(d) {
                             //console.log(d.temp);
                             return y(d.temp); })
                       .on("click", context)
                       .on("mouseover", mouseover)
                       .on("mousemove", mousemove)
                       .on("mouseout", mouseout)
                       .call(drag);
                       });
            } 
            
            
            function dottype(d) {
                d.x = +d.x;
                d.y = +d.y;
                return d;
            }
            
            function zoomed() {
                if (mode == 5) {
                    rect.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                    container.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
                }
            }
           
            
			
			
			
			
// Add a dot where the user clicks, and record them in "TimeTempData" array:
			var TimeTempData = [];
			
            function added() {
                if (isDrag == 0) {
                    var coords = d3.mouse(this);
                    container.select(".dots")
                    .append("g")
                    .attr("class", "dot")                    
                    .append("circle")
                    .attr("r", 15)
                    .attr("cx", function(d) { return coords[0]; })
                    .attr("cy", function(d) { return coords[1]; })
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseout", mouseout)
                    .on("click", context)                    
                    .call(drag)
					//done adding a dot 
					
					
					//to pull time, temp from x,y pixel values:
					var TransformedCoords = 
					    [x.invert(coords[0]), y.invert(coords[1])];
						 //   [x.invert(coords[0]), y.invert(coords[1])];
					TimeTempData.push(TransformedCoords);
					
					
					
                } else {
                    isDrag = 0;
                }
            }
            
            function context() {
                if (d3.event.shiftKey) {
                    d3.select(this).remove();
                }
            }
            
            function dragstarted(d) {
                isDrag = 1;
                d3.event.sourceEvent.stopPropagation();
                d3.select(this).classed("dragging", true);
            }
            
            function dragged(d) {
                //console.log(d3.event.x);
                //console.log(d3.event.y);
                d3.select(this).attr("cx", function() { return d3.event.x; })
                .attr("cy", function() { return d3.event.y; });
            }
            
            function dragended(d) {
                d3.select(this).classed("dragging", false);
            }
            
			
			// stuff that wasn't in previous version; what does it do?
            function mouseover() {
                div.transition()
                .duration(100)
                .style("opacity", .7);
            }
            
            function mousemove() {
                var x0 = x.invert(d3.mouse(this)[0]);
                var y0 = y.invert(d3.mouse(this)[1]);
                div
                .text(x0 + ", " + y0)//d3.event.pageY)
                .style("left", (d3.event.pageX + 20) + "px")
                .style("top", (d3.event.pageY - 12) + "px");
            }
            
            function mouseout() {
                div.transition()
                .duration(500)
                .style("opacity", 1e-6);
            }
//done deleting dot / moving dot
			
			
			
			
			
			
			
            // Create X Axis name label
            container.append("text")
            .attr("class", "x label")
            .attr("text-anchor", "end")
            .attr("x", width/2 + margin.left + 50)
            .attr("y", height + 55)
            .text("Time (Months/Years)");
            
            // Create Y Axis name label
            container.append("text")
            .attr("class", "y label")
            .attr("text-anchor", "end")
            .attr("y", -margin.left)
            .attr("x", -115)
            .attr("dy", ".75em")
            .attr("transform", "rotate(-90)")
            .text("Temperature (ÂºF)");

            
            svg.append("g").attr("class", "x axis")
            .attr("transform", "translate(" + 0 + "," + height + ")")
            .call(xAxis);
            svg.append("g").attr("class", "y axis")
            .call(yAxis);
            
            
            
            initGraph();
            	
			
			
			
			
			
			
			
			
			
//Draw temperature readings in upper right

svg.append("text")  //just text labels
	.attr("x", SVGWidth - SidebarWidth)
	.attr("y", 18)
	.style("fill", "#000")
	.attr("font-weight","Bold")
	.style('font-family', 'Arial')
	.style('font-size', '20px')
	.text("Temperatures Now:");

var OperTempRect = svg.append("rect")  // Operative temp. box
    .attr("width", 100)
	.attr("height", 50)
	.attr("x", SVGWidth - SidebarWidth + 40)
	.attr("y", 28)
	.style("fill", "#ffff00")
	.style("stroke", "#000000")
	.style("stroke-width", "1px")
	.style("pointer-events", "all");  // what does this do?
	
	svg.append("text") 
		.attr("x", SVGWidth - SidebarWidth + 78)
		.attr("y", 52)
		.style("fill", "#000")
		.attr("font-weight","Bold")
		.style('font-family', 'Arial')
		.style('font-size', '22px')
		.text("75Â°"); 
		//function(d) { return Math.round(y.invert(coords[1]) ) } );
	svg.append("text") 
		.attr("x", SVGWidth - SidebarWidth + 55)
		.attr("y", 72)
		.style("fill", "#000")
		.attr("font-weight","Bold")
		.style('font-family', 'Arial')
		.style('font-size', '16px')
		.text("Operative");
		
	svg.append("rect")  // Air temp. box
		.attr("width", 50)
		.attr("height", 50)
		.attr("x", SVGWidth - SidebarWidth + 40)
		.attr("y", 78)
		.style("fill", "#bbff00")
		.style("stroke", "#000000")
		.style("stroke-width", "1px")
		.style("pointer-events", "all");  // what does this do?
		
		svg.append("text")  // Air temp text
			.attr("x", SVGWidth - SidebarWidth + 54)
			.attr("y", 100)
			.style("fill", "#000")
			.attr("font-weight","Bold")
			.style('font-family', 'Arial')
			.style('font-size', '16px')
			.text("73Â°"); 
		
		svg.append("text") 
			.attr("x", SVGWidth - SidebarWidth + 53)
			.attr("y", 120)
			.style("fill", "#000")
			.attr("font-weight","Bold")
			.style('font-family', 'Arial')
			.style('font-size', '16px')
			.text("Air");
		
		
	svg.append("rect")  // Radiant temp. box
		.attr("width", 50)
		.attr("height", 50)
		.attr("x", SVGWidth - SidebarWidth + 40 + 50)
		.attr("y", 78)
		.style("fill", "#ffbb00")
		.style("stroke", "#000000")
		.style("stroke-width", "1px")	
	
		svg.append("text")   // Radiant temp text
			.attr("x", SVGWidth - SidebarWidth + 105)
			.attr("y", 100)
			.style("fill", "#000")
			.attr("font-weight","Bold")
			.style('font-family', 'Arial')
			.style('font-size', '16px')
			.text("77Â°"); 
			
		svg.append("text") 
			.attr("x", SVGWidth - SidebarWidth + 100)
			.attr("y", 120)
			.style("fill", "#000")
			.attr("font-weight","Bold")
			.style('font-family', 'Arial')
			.style('font-size', '16px')
			.text("Rad");

//Done drawing temperature readings in upper right
		
			
			
			
			
			
//Status indicators for Heating & Cooling:
	
svg.append("text")   // Label "Heating / Cooling"
	.attr("x", SVGWidth - SidebarWidth)
	.attr("y", 380)
	.style("fill", "#000")
	.attr("font-weight","Bold")
	.style('font-family', 'Arial')
	.style('font-size', '22px')
	.text("Heating / Cooling:"); 

	
//add something to listen for state of heating / cooling from websockets
//add something to listen for state of heating / cooling from websockets
//add something to listen for state of heating / cooling from websockets
	var HeatingOn = true;
	var CoolingOn = false;
	

	var HeatingIcon = svg.append("image")   // Display icon for Heat on / off
		.attr("width", 70)
		.attr("height", 70)
		.attr("x", SVGWidth - SidebarWidth + 10)
		.attr("y", 390)
		if(HeatingOn == true) {
		HeatingIcon.attr("xlink:href", "assets/Icon_Fire_On.png");   
			}
		 else {
		HeatingIcon.attr("xlink:href", "assets/Icon_Fire_Off.png");   
		  }
	
	
	

	var CoolingIcon = svg.append("image")   // Display icon for cool on / off
		.attr("width", 70)
		.attr("height", 70)
		.attr("x", SVGWidth - SidebarWidth + 100)
		.attr("y", 390)
		if(CoolingOn == true) {
		CoolingIcon.attr("xlink:href", "assets/Icon_Ice_On.png");   
			}
		 else {
		CoolingIcon.attr("xlink:href", "assets/Icon_Ice_Off.png");   
		  }
//Done making status indicators for Heating & Cooling
			
			
			
			
			
			
			
			
			
			
			
			
			
            </script>


